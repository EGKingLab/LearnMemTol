---
title: "Processing_Phenotype_Data"
author: "Patricka Williams-Simon"
date: "7/13/2018"
output: html_document
---

```{r setup, include=FALSE}
library(readxl)
library(ggplot2)
library(DSPRqtl)
library(DSPRqtlDataA)
library(tidyverse)
```

## Read in LearnMem processed raw data and check 

```{r}
#rawd <- read.table("/MyGitHub/LearnMemTol/Data/HeatProc.txt",sep="\t", #header=TRUE, stringsAsFactors = FALSE)

rawdLM <- read.table("../Data/HeatProc_Learn.txt",sep="\t", header=TRUE, stringsAsFactors = FALSE)


str(rawdLM)
rawdLM[1:5]

```

## Read in ThermTol processed raw data and check
```{r}
rawdTT <- read.table("../Data/ThermalTol_processed.txt",sep="\t", header=TRUE, stringsAsFactors = FALSE)


str(rawdTT)
rawdTT[1:5]


```

## Find means and SEMs for all three traits

```{r}
L_MDATA <- rawdLM %>% 
  group_by(patRIL) %>% 
  summarise(Learning_Mean = mean(Learning),
            Learning_SEM = sd(Learning)/sqrt(length(Learning)),
            Memory_Mean = mean(Memory),
            Memory_SEM = sd(Memory)/sqrt(length(Memory)),
            N = length(Memory))





T_TDATA <- rawdTT %>% 
  group_by(patRIL) %>% 
  summarise(Incapacitation_Mean = mean(incapacitation),
            Incapacitation_SEM = sd(incapacitation)/sqrt(length(incapacitation)),
            N = length(incapacitation))
```

## Check to see if SEMs are SEMs (optional)

```{r}
L_MDATA[1:10,c('patRIL','Learning_SEM')]

#sd(rawd[rawd$patRIL==11002,'Learning'])/sqrt(length(rawd[rawd$patRIL==11002,'Learning']))

###Libby should i add TT here too?

```

## Save data (note to self: make sure working directory is set as ~/MyGitHUb/LearnMemTol/Data/)

```{r}
save(L_MDATA, file="../Data/L_MDATA.rda")

save(T_TDATA, file="../Data/T_TDATA.rda")

```

## Visualize data

```{r}

#Make histogram LearnMem
Learnhisto <- ggplot(L_MDATA, aes(x = Learning_Mean)) +
  geom_histogram()

Memhisto <- ggplot(L_MDATA, aes(x = Memory_Mean)) +
  geom_histogram()

ThermTolhisto <- ggplot(T_TDATA, aes(x = Incapacitation_Mean)) +
  geom_histogram()


#View graph
Learnhisto

Memhisto

ThermTolhisto

```

## Check dataset

```{r}
#Identify minimum mean (find really low learning point identified in histograms)
L_MDATA[which.min(L_MDATA$Learning_Mean),]
L_MDATA[which.min(L_MDATA$Memory_Mean),]
T_TData[which.min(T_TData$Incapacitation_Mean),]


#Look at indivial Learning PIs for RILs with lowest means
rawdLM[rawdLM$patRIL==12114,'Learning']
rawdLM[rawdLM$patRIL==11189,'Memory']

#Look at indivial Incapacitation times for RIL with lowest mean
rawdTT[rawdTT$patRIL==11459,'incapacitation']


#Identify maximum means.
L_MDATA[which.max(L_MDATA$Learning_Mean),]
L_MDATA[which.max(L_MDATA$Memory_Mean),]
T_TData[which.max(T_TData$Incapacitation_Mean),]


#Sort and save from decreasing to increasing means 
LearnDATA_sort <- L_MDATA[order(L_MDATA$Learning_Mean),]
MemDATA_sort <- L_MDATA[order(L_MDATA$Memory_Mean),]
ThermTolDATA_sort <- T_TDATA[order(T_TDATA$Incapacitation_Mean),]

#save sorted dataset
save(LearnDATA_sort, file="../Data/LearnDATA_sort.rda")
save(MemDATA_sort, file="../Data/MemDATA_sort.rda")
save(ThermTolDATA_sort, file="../Data/ThermTolDATA_sort.rda")

#Identify RILs in the low cohort
LearnDATA_sort[1:10,]
MemDATA_sort[1:10,]
ThermTolDATA_sort[1:10,]


#Identify RILs in the mid cohort
LearnDATA_sort[365:374,]
MemDATA_sort[365:374,]
ThermTolDATA_sort[365:374,]

#Identify RILs in the high cohort
LearnDATA_sort[731:741,]
MemDATA_sort[731:741,]
ThermTolDATA_sort[720:731,]

```

##Transform data set (only if necessary). There are several methods used to transform data, choose the best fit.

```{r}

#log transformation, log10 transformation, arcsign transformation 


#sqaure root transformation
T_TDATA$Tolsqrtvariable<-sqrt(T_TDATA$Incapacitation_Mean)

#after transformation always visualize data
ggplot(T_TDATA, aes(x = T_TDATA$Tolsqrtvariable)) +
  geom_histogram()


#save new dataset
save(T_TDATA, file="../Data/T_TDATA.rda")


#power transformation

L_MDATA$LearnPowerTrans <- L_MDATA$Learning_Mean^3

ggplot(L_MDATA, aes(x = LearnPowerTrans)) +
  geom_histogram()

save(L_MDATA, file="../Data/L_MDATA.rda")

```

