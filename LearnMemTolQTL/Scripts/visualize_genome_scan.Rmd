---
title: "QTL plots"
author: "Patricka Williams-Simon & ElizabethKing"
date: "7/20/2018"
output: html_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(ggrepel)
library(tidyr)
library(dplyr)
library(reshape)
library(cowplot)
```

#load scan results

```{r}
source(file="../../Functions/ggplot_theme.R")
source(file="../../Functions/mappingfunctions.R")

load(file="../ProcessedData/Lodscores_3traits.rda")
load(file= "../ProcessedData/sig_ths.rda")

load(file="../../LearnMemTolQTL/ProcessedData/myGenos.rda")
Nrils <- nrow(myGenos$phenotype)
rm(myGenos)

#set value for theresholds 
fdr <- min(fdr.out$fdr$threshold[fdr.out$fdr$fdr<=0.05])
fwer <- fdr.out$fwer

pfdr <- getP(fdr,Nrils,7,Nrils-8)
pfwer <- getP(fwer,Nrils,7,Nrils-8)

#get peaks
load(file ="../ProcessedData/Peaks_wCIs.rda")


```

#Making qtl plots using ggplot

```{r}

#make dataframe long
obs.LM_long <-gather(obs.LL, key='Trait', value='LOD', LearnPowerTrans, Memory_Mean)
obs.LM_long$Pval <- getP(obs.LM_long$LOD,Nrils,7,Nrils-8)
top <- max(obs.LM_long$Pval)

#plot using ggplot
line.ww <- 0.5

p1 <- ggplot(obs.LM_long, aes(x=Gaxis, y=Pval, color=Trait)) +
  geom_rect(xmin=66.3,ymin=-10,xmax=120.3,ymax=top+10,fill='aliceblue',color='aliceblue')+
  geom_rect(xmin=174,ymin=-10,xmax=221,ymax=top+10,fill='aliceblue',color='aliceblue')+
    geom_segment(x=-50, xend=275,y=pfdr,yend=pfdr, color='black', size=line.ww) +
  geom_text(label= "FDR", x=295, y=pfdr, color='black',size=3.5) +
  geom_text(label= "FWER", x=302, y=pfwer, color='black',size=3.5) +
  geom_segment(x=-50, xend=275,y=pfwer,yend=pfwer, color='black', size=line.ww, lty=3) +
  geom_line(alpha=0.8, size=line.ww) +
  scale_x_continuous(breaks=c(0,66.3,120,174,221,277,33.15,98.3,145,205,249), 
                     labels=c(0,"66  0",54,"108  0",47,103,'\nX','\n2L','\n2R','\n3L','\n3R'),limits = c(-0.01,max(obs.LM_long$Gaxis)+25))+
  
  theme(axis.ticks.x=element_blank())+
  ylab(expression("-log"[10]*"(P-value)"))+
  xlab("Position (cM)") +
  scale_color_discrete(name='Phenotype',breaks=c('LearnPowerTrans','Memory_Mean'), labels=c('Learning','Memory'))+
  my_theme

ggsave(p1, filename = "../Plots/L_M_QTL.pdf", height=3,width=6.5)

```


