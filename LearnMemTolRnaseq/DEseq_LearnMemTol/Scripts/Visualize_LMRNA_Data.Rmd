---
title: "Visualizing_TTRNA_Data"
author: "Patricka Williams-Simon"
date: "8/20/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DESeq2)
library(dplyr)
library(stringr)
library(sva)
library(ggplot2)
```

# MA plot

```{r}
load("../Data/LearnresSVOrder.Rda")
load("../Data/MemresSVOrder.Rda")

# Could do with built-in DESeq2 function:
LearnMAplot <- DESeq2::plotMA(LearnresSVorder, ylim=c(-25,25))
MemMAplot <- DESeq2::plotMA(MemresSVorder, ylim=c(-25,25))

ggsave(LearnMAplot, file="../Plots/LearnMAplot.pdf", width=10, height=4)
ggsave(MemMAplot, file="../Plots/MemMAplot.pdf", width=10, height=4)

# see all results available
resultsNames(LearnresSVorder)
resultsNames(MemresSVorder)


```

#Volcano Plot (ggplot2)


```{r}

load("../Data/LearnresSVOrder.Rda")
load("../Data/MemresSVOrder.Rda")

str(LearnresSVorder)


Learngene_list <- as.data.frame(LearnresSVorder)
Memgene_list <- as.data.frame(MemresSVorder)



Learngene_list <-Learngene_list %>% mutate(Learn_Genes = ifelse(log2FoldChange >= 2, "A", ifelse(log2FoldChange <=-2, "B", "C")))

Memgene_list <-Memgene_list %>% mutate(Mem_Genes = ifelse(log2FoldChange >= 2, "A", ifelse(log2FoldChange <=-2, "B", "C")))


str(Learngene_list)
str(Memgene_list)


Learn_Volcanoplot <- ggplot(Learngene_list, aes(y=-log10(padj), x=log2FoldChange)) +
  geom_point(aes(colour = Learn_Genes), size=2, alpha=1/2 ) +
  geom_hline(yintercept = 1.30) +
  scale_color_manual(values=c('red','blue','black'),labels=c('Up Regulated','Down Regulated','Base Levels'))


Learn_Volcanoplot


Mem_Volcanoplot <- ggplot(Memgene_list, aes(y=-log10(padj), x=log2FoldChange)) +
  geom_point(aes(colour = Mem_Genes), size=2, alpha=1/2 ) +
  geom_hline(yintercept = 1.30) +
  scale_color_manual(values=c('red','blue','black'),labels=c('Up Regulated','Down Regulated','Base Levels'))


Mem_Volcanoplot

ggsave(Learn_Volcanoplot, filename="../Plots/Learn_Volcanoplot.pdf", width=6, height=4)
ggsave(Mem_Volcanoplot, filename="../Plots/Mem_Volcanoplot.pdf", width=6, height=4)


```

# PCA of samples
# different ways to visualize

```{r}
load("../Data/TTdds_deseq.Rda")

rlogtransTTdds_deseq <- rlogTransformation(TTdds_deseq, blind=TRUE) #time intensive
vstransTTdds_deseq <- varianceStabilizingTransformation(TTdds_deseq, blind = TRUE)

dev.off()
print(plotPCA(rlogtransTTdds_deseq, intgroup=c("treatement", "replicate")))
plotPCA(rlogtransTTdds_deseq, intgroup=c("treatment"), returnData=FALSE)

###save plots as pdf

# Visualize p-value optimization
attr(res.dds, "filterThreshold")
attr(res_int, "filterThreshold")

#NULL could mean too many DEs & independent (default in results()), filtering did not happen. Solution:

metadata(res.dds)$filterThreshold
metadata(res_int)$filterThreshold

plot(attr(res.dds, "filterNumRej"), type="b",
     xlab="quantiles of 'baseMean'",
     ylab="number of rejections")

# turn off independent filtering and see what happens
resNoFilt <- results(dds_deseq, independentFiltering = FALSE)
table(filtering=(res.dds$padj < 0.1), noFiltering=(resNoFilt$padj < 0.1))

# turn on independent filtering and see what happens
rv <- rowVars(counts(dds_deseq, normalized=TRUE))
resFiltByVar <- results(dds_deseq, filter = rv)
table(rowMean=(res.dds$padj < 0.1), rowVar=(resFiltByVar$padj < 0.1))
```


```

